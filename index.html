<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anu's English School - Plural Master</title>
    <style>
        :root { --primary: #2980b9; --secondary: #27ae60; --admin: #c0392b; --bg: #f4f7f6; --gold: #fff9c4; }
        body { font-family: 'Segoe UI', sans-serif; background-color: var(--bg); display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .container { background: white; width: 95%; max-width: 600px; padding: 30px; border-radius: 25px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); text-align: center; }
        .tab-buttons { display: flex; justify-content: center; margin-bottom: 25px; gap: 10px; }
        .tab-btn { flex: 1; padding: 12px; border: none; background: #dcdde1; cursor: pointer; border-radius: 10px; font-weight: bold; }
        .tab-btn.active { background: var(--primary); color: white; }
        input { padding: 15px; width: 85%; margin: 10px 0; border: 2px solid #eee; border-radius: 12px; font-size: 16px; outline: none; }
        button.action-btn { padding: 15px; background: var(--secondary); color: white; border: none; border-radius: 12px; cursor: pointer; font-size: 16px; font-weight: bold; width: 90%; margin-top: 15px; }
        .hidden { display: none; }
        #timer { font-size: 26px; color: #e67e22; font-weight: bold; margin: 15px 0; }
        #word-display { font-size: 32px; letter-spacing: 5px; margin: 20px 0; color: var(--primary); font-family: 'Courier New', monospace; font-weight: bold; border: 2px dashed #ddd; padding: 15px; border-radius: 15px; }
        .options { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .opt-btn { background: #f8f9fa; border: 2px solid #e0e0e0; padding: 20px; font-size: 22px; border-radius: 15px; cursor: pointer; font-weight: bold; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; background: white; }
        th, td { border-bottom: 1px solid #eee; padding: 12px; font-size: 13px; text-align: center; }
        th { background: #f8f9fa; color: #333; }
        #stats-panel { display: flex; flex-direction: column; background: #eee; padding: 10px; border-radius: 10px; margin-bottom: 15px; font-weight: bold; gap: 5px; }
        .stats-row { display: flex; justify-content: space-around; }
        .instruction-box { background: #fff8e1; padding: 15px; border-radius: 15px; text-align: left; margin-bottom: 20px; border-left: 5px solid #ffc107; font-size: 14px; }
        .fill-input { width: 80px; padding: 5px; border: 2px solid var(--primary); border-radius: 5px; text-align: center; font-weight: bold; font-size: 16px; }
        #custom-alert { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); display: flex; justify-content: center; align-items: center; z-index: 1000; visibility: hidden; }
        .alert-content { background: white; padding: 25px; border-radius: 15px; width: 300px; text-align: center; }
        .alert-btn { background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 8px; margin-top: 15px; cursor: pointer; }
        .winner-row { background: #fff9c4 !important; font-weight: bold; }
    </style>
</head>
<body onload="loadPublicLeaderboard()">

<div id="custom-alert">
    <div class="alert-content">
        <p id="alert-msg"></p>
        <button class="alert-btn" onclick="closeAlert()">OK</button>
    </div>
</div>

<div class="container">
    <div id="home-screen">
        <h1 style="color: #2c3e50; margin-bottom: 5px;">üè´ Anu's English School</h1>
        <h3 style="color: #2980b9; margin-top: 0;">Plural Nouns Master</h3>
        
        <div class="tab-buttons">
            <button class="tab-btn active" id="player-tab" onclick="switchTab('player')">‡∑Å‡∑í‡∑Ç‡∑ä‚Äç‡∂∫‡∂∫‡∑è</button>
            <button class="tab-btn" id="admin-tab" onclick="switchTab('admin')">‡∂¥‡∂ª‡∑í‡∂¥‡∑è‡∂Ω‡∂ö</button>
        </div>

        <div id="player-form">
            <div class="instruction-box">
                <h4>üìù ‡∑Ä‡∑í‡∂∑‡∑è‡∂ú ‡∂ã‡∂¥‡∂Ø‡∑ô‡∑É‡∑ä:</h4>
                <ul style="padding-left: 20px;">
                    <li>‡∂¥‡∑ä‚Äç‡∂ª‡∑Å‡∑ä‡∂± 100 (MCQ 75 + Paragraph 25).</li>
                    <li>‡∂ö‡∑è‡∂Ω‡∂∫ ‡∑Ä‡∑í‡∂±‡∑è‡∂©‡∑í 30 ‡∂ö‡∑í.</li>
                    <li><b>‡∂ë‡∂ö‡∑ä ‡∂Ö‡∂∫‡∑ô‡∂ö‡∑î‡∂ß ‡∂á‡∂≠‡∑î‡∑Ö‡∂≠‡∑ä ‡∂ö‡∑Ö ‡∑Ñ‡∑ê‡∂ö‡∑í ‡∂ã‡∂¥‡∂ª‡∑í‡∂∏ ‡∑Ä‡∑è‡∂ª ‡∂ú‡∂´‡∂±: 05.</b></li>
                </ul>
            </div>
            <input type="text" id="user-name" placeholder="‡∂î‡∂∂‡∑ö ‡∑É‡∂∏‡∑ä‡∂¥‡∑ñ‡∂ª‡∑ä‡∂´ ‡∂±‡∂∏">
            <input type="text" id="user-phone" placeholder="‡∂Ω‡∑í‡∂∫‡∑è‡∂¥‡∂Ø‡∑í‡∂Ç‡∂†‡∑í ‡∂Ø‡∑î‡∂ª‡∂ö‡∂Æ‡∂± ‡∂Ö‡∂Ç‡∂ö‡∂∫">
            <button class="action-btn" onclick="strictLogin()">‡∑Ä‡∑í‡∂∑‡∑è‡∂ú‡∂∫ ‡∂Ü‡∂ª‡∂∏‡∑ä‡∂∑ ‡∂ö‡∂ª‡∂±‡∑ä‡∂±</button>
        </div>

        <div id="admin-form" class="hidden">
            <input type="password" id="admin-pass" placeholder="Admin Password">
            <button class="action-btn" style="background: var(--admin);" onclick="loginAdmin()">Dashboard ‡∂ë‡∂ö‡∂ß ‡∂¥‡∑í‡∑Ä‡∑í‡∑É‡∑ô‡∂±‡∑ä‡∂±</button>
        </div>

        <div style="margin-top: 25px; max-height: 400px; overflow-y: auto;">
            <h3 style="color: #2c3e50;">üèÜ ‡∑É‡∑í‡∂∫‡∂Ω‡∑î‡∂∏ ‡∂¥‡∑ä‚Äç‡∂ª‡∂≠‡∑í‡∂µ‡∂Ω (Leaderboard)</h3>
            <table>
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>‡∂±‡∂∏</th>
                        <th>‡∂Ω‡∂ö‡∑î‡∂´‡∑î</th>
                        <th>‡∂Ø‡∑í‡∂±‡∂∫/‡∑Ä‡∑ö‡∂Ω‡∑è‡∑Ä</th>
                    </tr>
                </thead>
                <tbody id="public-score-list"></tbody>
            </table>
        </div>
    </div>

    <div id="game-screen" class="hidden">
        <div id="timer">‚è≥ 30:00</div>
        <div id="stats-panel">
            <div class="stats-row">
                <span id="score-display">Score: 0/100</span>
                <span id="attempt-display">Question: 1/100</span>
            </div>
        </div>
        <div id="feedback" style="height: 30px; font-weight: bold;"></div>
        <div id="quiz-area">
            <div id="singular-hint" style="color:#666; font-size:14px;">Make this Plural:</div>
            <div id="word-display">____</div>
            <div class="options" id="options-container"></div>
        </div>
        <div id="paragraph-area" class="hidden">
            <div id="para-content" style="text-align: left; line-height: 2; background: #fff; padding: 15px; border-radius: 10px; border: 1px solid #ddd;"></div>
            <button class="action-btn" onclick="checkParaAnswer()">‡∂¥‡∑í‡∑Ö‡∑í‡∂≠‡∑î‡∂ª‡∑î ‡∂á‡∂≠‡∑î‡∑Ö‡∂≠‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±</button>
        </div>
    </div>

    <div id="congrats-screen" class="hidden">
        <div style="padding: 30px; border-radius: 20px; background: #f0fff4; border: 2px solid #27ae60;">
            <h1 style="color: #27ae60;">‡∂¥‡∑ä‚Äç‡∂ª‡∂≠‡∑í‡∂µ‡∂Ω ‡∑É‡∂ß‡∑Ñ‡∂±‡∑ä ‡∑Ä‡∑í‡∂∫!</h1>
            <p id="final-msg" style="font-size: 20px; font-weight: bold;"></p>
            <button class="action-btn" onclick="location.reload()">‡∂∏‡∑î‡∂Ω‡∂ß ‡∂∫‡∂±‡∑ä‡∂±</button>
        </div>
    </div>
</div>

<script>
    // ‚ö†Ô∏è ‡∂î‡∂∂‡∑ö Google Apps Script URL ‡∂ë‡∂ö ‡∂∏‡∑ô‡∂≠‡∂±‡∂ß ‡∂Ø‡∑è‡∂±‡∑ä‡∂±
    const API_URL = "https://script.google.com/macros/s/AKfycbwczGQp0Yioq3cYD_FMGAzOh_A00-1q5GRrfdoNccimToRlK3y5T8sd5GzpfX3keY-W/exec"; 
    
    const ADMIN_PASS = "51001992";
    let ALLOWED_NUMS = ["0742780344", "0741435227", "0779810561", "077514248", "0765578086", "0760903373", "0764483930", "0741247326", "0764678350", "0717199812", "0768519713", "833553", "0769071499", "0783887761", "0703534515", "86", "87", "88", "89", "90", "91", "92", "93"];
    
    let score = 0, idx = 0, time = 1800, uName, uPhone, timer, isGameActive = false, allScores = [], startTime;

    // ‡∂¥‡∑ä‚Äç‡∂ª‡∑Å‡∑ä‡∂± 75‡∂ö‡∑ä (Sample)
    const QUESTIONS = [
        {s: "BOOK", p: "BOOKS", suf: "S"}, {s: "CAT", p: "CATS", suf: "S"}, {s: "DOG", p: "DOGS", suf: "S"}, {s: "PEN", p: "PENS", suf: "S"}, {s: "CUP", p: "CUPS", suf: "S"}, {s: "TREE", p: "TREES", suf: "S"}, {s: "CAR", p: "CARS", suf: "S"}, {s: "BIRD", p: "BIRDS", suf: "S"}, {s: "DOOR", p: "DOORS", suf: "S"}, {s: "FAN", p: "FANS", suf: "S"}, {s: "BAG", p: "BAGS", suf: "S"}, {s: "DESK", p: "DESKS", suf: "S"}, {s: "PHONE", p: "PHONES", suf: "S"}, {s: "SCHOOL", p: "SCHOOLS", suf: "S"}, {s: "PLAYER", p: "PLAYERS", suf: "S"}, {s: "SHOE", p: "SHOES", suf: "S"}, {s: "BALL", p: "BALLS", suf: "S"}, {s: "APPLE", p: "APPLES", suf: "S"}, {s: "BOTTLE", p: "BOTTLES", suf: "S"}, {s: "CHAIR", p: "CHAIRS", suf: "S"}, {s: "MAP", p: "MAPS", suf: "S"}, {s: "LAMP", p: "LAMPS", suf: "S"}, {s: "WALL", p: "WALLS", suf: "S"}, {s: "CLOCK", p: "CLOCKS", suf: "S"}, {s: "RING", p: "RINGS", suf: "S"},
        {s: "BUS", p: "BUSES", suf: "ES"}, {s: "BOX", p: "BOXES", suf: "ES"}, {s: "WATCH", p: "WATCHES", suf: "ES"}, {s: "DISH", p: "DISHES", suf: "ES"}, {s: "FOX", p: "FOXES", suf: "ES"}, {s: "GLASS", p: "GLASSES", suf: "ES"}, {s: "DRESS", p: "DRESSES", suf: "ES"}, {s: "BRUSH", p: "BRUSHES", suf: "ES"}, {s: "BENCH", p: "BENCHES", suf: "ES"}, {s: "CHURCH", p: "CHURCHES", suf: "ES"}, {s: "TAX", p: "TAXES", suf: "ES"}, {s: "MATCH", p: "MATCHES", suf: "ES"}, {s: "WISH", p: "WISHES", suf: "ES"}, {s: "CLASS", p: "CLASSES", suf: "ES"}, {s: "TORCH", p: "TORCHES", suf: "ES"}, {s: "COACH", p: "COACHES", suf: "ES"}, {s: "BRANCH", p: "BRANCHES", suf: "ES"}, {s: "FLASH", p: "FLASHES", suf: "ES"}, {s: "BOSS", p: "BOSSES", suf: "ES"}, {s: "SANDWICH", p: "SANDWICHES", suf: "ES"}, {s: "BUSH", p: "BUSHES", suf: "ES"}, {s: "AX", p: "AXES", suf: "ES"}, {s: "PEACH", p: "PEACHES", suf: "ES"}, {s: "QUIZ", p: "QUIZZES", suf: "ES"}, {s: "GAS", p: "GASES", suf: "ES"},
        {s: "BABY", p: "BABIES", suf: "IES"}, {s: "CITY", p: "CITIES", suf: "IES"}, {s: "FLY", p: "FLIES", suf: "IES"}, {s: "LADY", p: "LADIES", suf: "IES"}, {s: "STORY", p: "STORIES", suf: "IES"}, {s: "PUPPY", p: "PUPPIES", suf: "IES"}, {s: "CANDY", p: "CANDIES", suf: "IES"}, {s: "PARTY", p: "PARTIES", suf: "IES"}, {s: "COUNTRY", p: "COUNTRIES", suf: "IES"}, {s: "FAMILY", p: "FAMILIES", suf: "IES"}, {s: "SKY", p: "SKIES", suf: "IES"}, {s: "ARMY", p: "ARMIES", suf: "IES"}, {s: "BOY", p: "BOYS", suf: "S"}, {s: "TOY", p: "TOYS", suf: "S"}, {s: "DAY", p: "DAYS", suf: "S"}, {s: "KEY", p: "KEYS", suf: "S"}, {s: "PLAY", p: "PLAYS", suf: "S"}, {s: "TRAY", p: "TRAYS", suf: "S"}, {s: "MONKEY", p: "MONKEYS", suf: "S"}, {s: "DONKEY", p: "DONKEYS", suf: "S"}, {s: "GUY", p: "GUYS", suf: "S"}, {s: "VALLEY", p: "VALLEYS", suf: "S"}, {s: "RAY", p: "RAYS", suf: "S"}, {s: "HOLIDAY", p: "HOLIDAYS", suf: "S"}, {s: "WAY", p: "WAYS", suf: "S"}
    ];
    const PARA_ANSWERS = ["monkeys", "donkeys", "boys", "toys", "trays", "candies", "cherries", "cities", "countries", "parties", "boxes", "glasses", "dishes", "buses", "ways", "ladies", "dresses", "babies", "keys", "trees", "foxes", "watches", "days", "skies", "families"];

    async function loadPublicLeaderboard() {
        try {
            const res = await fetch(API_URL);
            allScores = await res.json();
            allScores.sort((a,b) => b.score - a.score);
            const list = document.getElementById('public-score-list');
            list.innerHTML = allScores.map((s, index) => {
                let isTop = (index === 0 && s.score > 0);
                return `<tr class="${isTop ? 'winner-row' : ''}">
                    <td>${index + 1}</td>
                    <td>${s.name}</td>
                    <td>${s.score}</td>
                    <td style="font-size:10px;">${s.date}</td>
                </tr>`;
            }).join("");
        } catch(e) { console.log("‡∂Ø‡∂≠‡∑ä‡∂≠ ‡∂Ω‡∂∂‡∑è ‡∂ú‡∑ê‡∂±‡∑ì‡∂∏‡∂ß ‡∂±‡∑ú‡∑Ñ‡∑ê‡∂ö."); }
    }

    async function strictLogin() {
        uName = document.getElementById('user-name').value.trim();
        uPhone = document.getElementById('user-phone').value.trim();
        if(!uName || !uPhone) return myAlert("‡∂ö‡∂ª‡∑î‡∂´‡∑è‡∂ö‡∂ª ‡∂±‡∂∏ ‡∑É‡∑Ñ ‡∂Ø‡∑î‡∂ª‡∂ö‡∂Æ‡∂± ‡∂Ö‡∂Ç‡∂ö‡∂∫ ‡∂á‡∂≠‡∑î‡∑Ö‡∂≠‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±.");
        if(!ALLOWED_NUMS.includes(uPhone)) return myAlert("‡∂î‡∂∂‡∂ú‡∑ö ‡∂Ø‡∑î‡∂ª‡∂ö‡∂Æ‡∂± ‡∂Ö‡∂Ç‡∂ö‡∂∫ ‡∂Ω‡∑í‡∂∫‡∑è‡∂¥‡∂Ø‡∑í‡∂Ç‡∂†‡∑í ‡∑Ä‡∑ì ‡∂±‡∑ú‡∂∏‡∑ê‡∂≠.");

        // ‡∑Ä‡∑è‡∂ª 5 ‡∂¥‡∂ª‡∑ì‡∂ö‡∑ä‡∑Ç‡∑è‡∑Ä
        let attempts = allScores.filter(s => String(s.phone) === String(uPhone)).length;
        if(attempts >= 5) return myAlert("‡∂î‡∂∂ ‡∂∏‡∑ô‡∂∏ ‡∑Ä‡∑í‡∂∑‡∑è‡∂ú‡∂∫‡∂ß ‡∂¥‡∑ô‡∂±‡∑ì ‡∑É‡∑í‡∂ß‡∑í‡∂∫ ‡∑Ñ‡∑ê‡∂ö‡∑í ‡∂ã‡∂¥‡∂ª‡∑í‡∂∏ ‡∑Ä‡∑è‡∂ª 5‡∂∏ (Attempts) ‡∑É‡∂∏‡∑ä‡∂¥‡∑ñ‡∂ª‡∑ä‡∂´ ‡∂ö‡∂ª ‡∂á‡∂≠.");

        startTime = new Date().toLocaleString('en-GB');
        isGameActive = true;
        document.getElementById('home-screen').classList.add('hidden');
        document.getElementById('game-screen').classList.remove('hidden');
        
        timer = setInterval(() => {
            time--;
            let m = Math.floor(time/60), s = time%60;
            document.getElementById('timer').innerText = `‚è≥ ${m}:${s<10?'0':''}${s}`;
            if(time <= 0) endGame();
        }, 1000);
        next();
    }

    async function saveScore() {
        if(!isGameActive) return;
        const payload = { "name": uName, "phone": uPhone, "score": score, "date": startTime };
        try {
            await fetch(API_URL, { 
                method: 'POST', 
                mode: 'no-cors', 
                cache: 'no-cache',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload) 
            });
        } catch(e) { console.error("Score ‡∂ë‡∂ö Save ‡∑Ä‡∑î‡∂´‡∑ö ‡∂±‡∑ê‡∑Ñ‡∑ê."); }
    }

    async function endGame() {
        clearInterval(timer);
        await saveScore();
        isGameActive = false;
        document.getElementById('game-screen').classList.add('hidden');
        document.getElementById('congrats-screen').classList.remove('hidden');
        document.getElementById('final-msg').innerText = `${uName}, ‡∂î‡∂∂ ‡∂Ω‡∂∂‡∑è‡∂ú‡∂≠‡∑ä ‡∂Ω‡∂ö‡∑î‡∂´‡∑î ‡∂¥‡∑ä‚Äç‡∂ª‡∂∏‡∑è‡∂´‡∂∫: ${score}/100`;
    }

    function next() {
        if(idx >= 75) return startParagraph();
        document.getElementById('feedback').innerText = "";
        document.getElementById('attempt-display').innerText = `Question: ${idx + 1}/100`;
        let q = QUESTIONS[idx];
        document.getElementById('word-display').innerText = q.p.replace(q.suf, "____");
        document.getElementById('singular-hint').innerText = `Singular: ${q.s}`;
        
        let opts = ["S", "ES", "IES", "VES"].sort(() => Math.random() - 0.5);
        const cont = document.getElementById('options-container');
        cont.innerHTML = "";
        opts.forEach(o => {
            let b = document.createElement('button');
            b.className = "opt-btn"; b.innerText = o;
            b.onclick = () => {
                if(o === q.suf) { score++; document.getElementById('feedback').innerHTML = "<span style='color:green'>‡∑É‡∑Ñ‡∂∏‡∑î‡∂Ω‡∑í‡∂±‡∑ä‡∂∏ ‡∂±‡∑í‡∑Ä‡∑ê‡∂ª‡∂Ø‡∑í‡∂∫‡∑í!</span>"; }
                else { document.getElementById('feedback').innerHTML = "<span style='color:red'>‡∑Ä‡∑ê‡∂ª‡∂Ø‡∑í‡∂∫‡∑í!</span>"; }
                document.getElementById('score-display').innerText = `Score: ${score}/100`;
                idx++; setTimeout(next, 400);
            };
            cont.appendChild(b);
        });
    }

    function startParagraph() {
        document.getElementById('quiz-area').classList.add('hidden');
        document.getElementById('paragraph-area').classList.remove('hidden');
        let pText = `In the park, some <input id='p0' class='fill-input' placeholder='monkey'> and <input id='p1' class='fill-input' placeholder='donkey'> were playing. Small <input id='p2' class='fill-input' placeholder='boy'> had many <input id='p3' class='fill-input' placeholder='toy'>. On the <input id='p4' class='fill-input' placeholder='tray'>, there were sweet <input id='p5' class='fill-input' placeholder='candy'> and <input id='p6' class='fill-input' placeholder='cherry'>. People from different <input id='p7' class='fill-input' placeholder='city'> and <input id='p8' class='fill-input' placeholder='country'> came to the <input id='p9' class='fill-input' placeholder='party'>. They brought <input id='p10' class='fill-input' placeholder='box'> full of <input id='p11' class='fill-input' placeholder='glass'> and <input id='p12' class='fill-input' placeholder='dish'>. We saw many <input id='p13' class='fill-input' placeholder='bus'> on the <input id='p14' class='fill-input' placeholder='way'>. Some <input id='p15' class='fill-input' placeholder='lady'> wore beautiful <input id='p16' class='fill-input' placeholder='dress'>. Their <input id='p17' class='fill-input' placeholder='baby'> played with <input id='p18' class='fill-input' placeholder='key'>. Under the <input id='p19' class='fill-input' placeholder='tree'>, there were some <input id='p20' class='fill-input' placeholder='fox'>. The <input id='p21' class='fill-input' placeholder='watch'> showed it was late. We spent many <input id='p22' class='fill-input' placeholder='day'> there. The <input id='p23' class='fill-input' placeholder='sky'> were blue. Our <input id='p24' class='fill-input' placeholder='family'> were happy.`;
        document.getElementById('para-content').innerHTML = pText;
    }

    function checkParaAnswer() {
        let paraScore = 0;
        PARA_ANSWERS.forEach((ans, i) => {
            let input = document.getElementById('p' + i).value.toLowerCase().trim();
            if(input === ans) paraScore++;
        });
        score += paraScore;
        endGame();
    }

    function myAlert(msg) { document.getElementById('alert-msg').innerText = msg; document.getElementById('custom-alert').style.visibility = 'visible'; }
    function closeAlert() { document.getElementById('custom-alert').style.visibility = 'hidden'; }
    function switchTab(t) {
        document.getElementById('player-form').classList.toggle('hidden', t==='admin');
        document.getElementById('admin-form').classList.toggle('hidden', t==='player');
        document.getElementById('player-tab').classList.toggle('active', t==='player');
        document.getElementById('admin-tab').classList.toggle('active', t==='admin');
    }
</script>
</body>
</html>